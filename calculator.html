<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê±´ì¶• ê·œëª¨ê²€í† </title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: linear-gradient(135deg, #6366f1, #9333ea); min-height: 100vh; padding: 24px 16px; }
        .card { max-width: 600px; margin: 0 auto; background: white; border-radius: 16px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
        .header { background: linear-gradient(135deg, #6366f1, #9333ea); color: white; padding: 24px; text-align: center; }
        .header h1 { font-size: 22px; font-weight: 700; margin-bottom: 4px; }
        .header p { font-size: 13px; opacity: 0.8; }
        .body { padding: 24px; display: flex; flex-direction: column; gap: 20px; }
        .field label { display: block; font-size: 12px; font-weight: 700; color: #555; margin-bottom: 6px; }
        .field label span { font-weight: 400; color: #16a34a; margin-left: 8px; }
        .field input, .field select {
            width: 100%; padding: 10px 12px; border: 2px solid #d1d5db;
            border-radius: 8px; font-size: 14px; outline: none;
        }
        .btn-row { display: flex; gap: 8px; margin-top: 8px; }
        .btn { flex: 1; padding: 10px; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; }
        .btn-blue { background: #3b82f6; color: white; }
        .btn-blue:disabled { background: #93c5fd; cursor: not-allowed; }
        .btn-green { background: #10b981; color: white; }
        .status { margin-top: 8px; padding: 8px 12px; border-radius: 6px; font-size: 12px; font-weight: 500; }
        .s-info    { background: #eff6ff; border: 1px solid #bfdbfe; color: #1d4ed8; }
        .s-success { background: #f0fdf4; border: 1px solid #bbf7d0; color: #15803d; }
        .s-error   { background: #fef2f2; border: 1px solid #fecaca; color: #b91c1c; }
        .s-warn    { background: #fffbeb; border: 1px solid #fde68a; color: #92400e; }
        .raw-result { margin-top: 6px; padding: 8px 12px; background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 12px; color: #6b7280; }
        .raw-result strong { color: #4f46e5; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        const zoneData = {
            'ì¼ë°˜ì£¼ê±°ì§€ì—­_2ì¢…': { appliedFAR: 2.49 },
            'ì¼ë°˜ì£¼ê±°ì§€ì—­_3ì¢…': { appliedFAR: 2.99 },
            'ì¤€ì£¼ê±°ì§€ì—­':       { appliedFAR: 3.99 },
            'ì¼ë°˜ìƒì—…ì§€ì—­':     { appliedFAR: 7.99 },
        };

        const zoneNameToKey = (name) => {
            if (!name) return null;
            const map = {
                'ì œ1ì¢…ì „ìš©ì£¼ê±°ì§€ì—­': 'ì¼ë°˜ì£¼ê±°ì§€ì—­_2ì¢…',
                'ì œ2ì¢…ì „ìš©ì£¼ê±°ì§€ì—­': 'ì¼ë°˜ì£¼ê±°ì§€ì—­_2ì¢…',
                'ì œ1ì¢…ì¼ë°˜ì£¼ê±°ì§€ì—­': 'ì¼ë°˜ì£¼ê±°ì§€ì—­_2ì¢…',
                'ì œ2ì¢…ì¼ë°˜ì£¼ê±°ì§€ì—­': 'ì¼ë°˜ì£¼ê±°ì§€ì—­_2ì¢…',
                'ì œ3ì¢…ì¼ë°˜ì£¼ê±°ì§€ì—­': 'ì¼ë°˜ì£¼ê±°ì§€ì—­_3ì¢…',
                'ì¤€ì£¼ê±°ì§€ì—­':       'ì¤€ì£¼ê±°ì§€ì—­',
                'ì¤‘ì‹¬ìƒì—…ì§€ì—­':     'ì¼ë°˜ìƒì—…ì§€ì—­',
                'ì¼ë°˜ìƒì—…ì§€ì—­':     'ì¼ë°˜ìƒì—…ì§€ì—­',
                'ê·¼ë¦°ìƒì—…ì§€ì—­':     'ì¼ë°˜ìƒì—…ì§€ì—­',
                'ìœ í†µìƒì—…ì§€ì—­':     'ì¼ë°˜ìƒì—…ì§€ì—­',
            };
            for (const [k, v] of Object.entries(map)) {
                if (name.includes(k)) return v;
            }
            if (zoneData[name]) return name;
            return null;
        };

        function App() {
            const [location, setLocation]   = useState('ì„œìš¸íŠ¹ë³„ì‹œ ì„±ë™êµ¬ ë„ì„ ë™ 39-2');
            const [zoneType, setZoneType]   = useState('ì¼ë°˜ì£¼ê±°ì§€ì—­_3ì¢…');
            const [landArea, setLandArea]   = useState(2845.3);
            const [searching, setSearching] = useState(false);
            const [status, setStatus]       = useState(null);
            const [rawZone, setRawZone]     = useState('');

            const showStatus = (text, type, ms = 8000) => {
                setStatus({ text, type });
                if (ms) setTimeout(() => setStatus(null), ms);
            };

            const openNaver = () => {
                if (!location.trim()) return;
                window.open('https://map.naver.com/p/search/' + encodeURIComponent(location), '_blank');
            };

            const autoSearch = async () => {
                const addr = location.trim();
                if (!addr) { showStatus('ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”', 'warn'); return; }

                setSearching(true);
                setRawZone('');
                showStatus('ğŸ” ìš©ë„ì§€ì—­ ì¡°íšŒ ì¤‘...', 'info', 0);

                try {
                    const res = await fetch('/search', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ address: addr }),
                    });
                    if (!res.ok) throw new Error('ì„œë²„ ì˜¤ë¥˜ ' + res.status);
                    const data = await res.json();
                    console.log('ì‘ë‹µ:', data);

                    if (data.final) {
                        setRawZone(data.final);
                        const key = zoneNameToKey(data.final);
                        if (key) {
                            setZoneType(key);
                            showStatus('âœ… ìë™ ì ìš©: ' + data.final + ' â†’ ' + key, 'success');
                        } else {
                            showStatus('âš ï¸ ì¡°íšŒë¨: ' + data.final + ' â€” ì•„ë˜ì—ì„œ ì§ì ‘ ì„ íƒí•˜ì„¸ìš”', 'warn');
                        }
                    } else {
                        showStatus('âŒ ìš©ë„ì§€ì—­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì£¼ì†Œë¥¼ í™•ì¸í•˜ì„¸ìš”.', 'error');
                    }
                } catch (e) {
                    console.error('ì˜¤ë¥˜:', e);
                    showStatus('âŒ ì„œë²„ ì—°ê²° ì‹¤íŒ¨ â€” python3 web_app.py ì‹¤í–‰ í™•ì¸', 'error');
                } finally {
                    setSearching(false);
                }
            };

            const sc = status ? { info: 's-info', success: 's-success', error: 's-error', warn: 's-warn' }[status.type] : '';

            return (
                <div className="card">
                    <div className="header">
                        <h1>ğŸ—ï¸ ê±´ì¶• ê·œëª¨ê²€í† </h1>
                        <p>ë¹ ë¥¸ ì‚¬ì—…ì„± íŒë‹¨ ë„êµ¬</p>
                    </div>
                    <div className="body">

                        <div className="field">
                            <label>ëŒ€ì§€ìœ„ì¹˜</label>
                            <input
                                type="text"
                                value={location}
                                onChange={e => setLocation(e.target.value)}
                                onKeyDown={e => e.key === 'Enter' && autoSearch()}
                                placeholder="ì˜ˆ: ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ ì—­ì‚¼ë™ 123-45"
                            />
                            <div className="btn-row">
                                <button className="btn btn-blue" onClick={autoSearch} disabled={searching}>
                                    {searching ? 'â³ ì¡°íšŒ ì¤‘...' : 'ğŸ” ìš©ë„ì§€ì—­ ìë™ê²€ìƒ‰'}
                                </button>
                                <button className="btn btn-green" onClick={openNaver}>
                                    ğŸ—ºï¸ ë„¤ì´ë²„
                                </button>
                            </div>
                            {status && <div className={'status ' + sc}>{status.text}</div>}
                            {rawZone && (
                                <div className="raw-result">
                                    ğŸ“ ì¡°íšŒëœ ìš©ë„ì§€ì—­: <strong>{rawZone}</strong>
                                </div>
                            )}
                        </div>

                        <div className="field">
                            <label>
                                ìš©ë„ì§€ì—­
                                {rawZone && <span>âœ¨ ìë™ ì„¤ì •ë¨</span>}
                            </label>
                            <select value={zoneType} onChange={e => setZoneType(e.target.value)}>
                                {Object.keys(zoneData).map(k => (
                                    <option key={k} value={k}>{k}</option>
                                ))}
                            </select>
                        </div>

                        <div className="field">
                            <label>ëŒ€ì§€ë©´ì  (ã¡)</label>
                            <input
                                type="number"
                                value={landArea}
                                onChange={e => setLandArea(parseFloat(e.target.value) || 0)}
                            />
                        </div>

                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
